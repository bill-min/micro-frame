import { getSource } from "../../../util/stream";

$ {
  const streamSource = getSource(input.from, out);
  const stream = streamSource.slot(input.slot);
}
<div id=component.id class=input.class style=input.style data-slot=input.slot data-from=input.from>
  <macro|{ loaded }| name="wait">
    <await(stream.next())
      client-reorder=input.clientReorder
      timeout=input.timeout
      placeholder=(loaded ? undefined : input.loading)
    >
      <@then|{ value, done }|>
        <if(!done)>
          $!{value}
          <wait loaded=true />
        </if>
      </@then>
      <@catch|e|>
        <script>document.getElementById(${JSON.stringify(component.id)}).textContent=""</script>
        <${input.catch}(e)/>
      </@catch>
    </await>
  </macro>
  $ out.bf("@_", component, true);
  <if(stream)>
    <wait/>
  </if>
  $ out.ef();
</div>
